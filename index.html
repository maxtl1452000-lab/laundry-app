<script>
  // Cấu hình Firebase (thay bằng cấu hình từ Firebase Console)
  const firebaseConfig = {
    apiKey: "AIzaSyBbVgkJSmr0p_ydkQ0oQF1QFGgeUeIfcmA",
    authDomain: "laundry-order-bd0ca.firebaseapp.com",
    projectId: "laundry-order-bd0ca",
    storageBucket: "laundry-order-bd0ca.firebasestorage.app",
    messagingSenderId: "545130982048",
    appId: "1:545130982048:web:362f236a71d4711795b7c5"
  };

  // Khởi tạo Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  async function addEntry() {
    const roomNumber = document.getElementById('roomNumber').value;
    const weight = parseFloat(document.getElementById('weight').value);
    const quickWash = document.getElementById('quickWash').checked;
    const shoes = document.getElementById('shoes').checked;

    if (!roomNumber || isNaN(weight) || weight <= 0) {
      alert('Vui lòng nhập số phòng và số kg hợp lệ!');
      return;
    }

    const notes = [];
    if (quickWash) notes.push('Giặt nhanh');
    if (shoes) notes.push('Thêm giày');

    const entry = {
      date: new Date().toISOString(),
      roomNumber,
      weight,
      notes: notes.join(', ')
    };

    try {
      await db.collection('laundryEntries').add(entry);
      clearForm();
      displayEntries();
    } catch (error) {
      console.error('Lỗi khi thêm dữ liệu:', error);
      alert('Đã có lỗi xảy ra khi lưu dữ liệu!');
    }
  }

  async function displayEntries() {
    const entryList = document.getElementById('entryList');
    entryList.innerHTML = '';
    try {
      const snapshot = await db.collection('laundryEntries').orderBy('date', 'desc').get();
      snapshot.forEach(doc => {
        const entry = doc.data();
        const row = document.createElement('tr');
        row.innerHTML = `
          <td class="p-2">${new Date(entry.date).toLocaleDateString('vi-VN')}</td>
          <td class="p-2">${entry.roomNumber}</td>
          <td class="p-2">${entry.weight} kg</td>
          <td class="p-2">${entry.notes || 'Không'}</td>
        `;
        entryList.appendChild(row);
      });
    } catch (error) {
      console.error('Lỗi khi tải dữ liệu:', error);
      alert('Đã có lỗi xảy ra khi tải dữ liệu!');
    }
  }

  async function generateReport() {
    const reportMonth = document.getElementById('reportMonth').value;
    if (!reportMonth) {
      alert('Vui lòng chọn tháng để xem báo cáo!');
      return;
    }

    const [year, month] = reportMonth.split('-');
    const startDate = new Date(`${year}-${month}-01`);
    const endDate = new Date(year, month, 0); // Ngày cuối tháng

    try {
      const snapshot = await db.collection('laundryEntries')
        .where('date', '>=', startDate.toISOString())
        .where('date', '<=', endDate.toISOString())
        .get();

      const totalWeight = snapshot.docs.reduce((sum, doc) => sum + doc.data().weight, 0);
      document.getElementById('reportResult').innerHTML = `Tổng số kg trong tháng ${month}/${year}: ${totalWeight.toFixed(1)} kg`;
    } catch (error) {
      console.error('Lỗi khi tạo báo cáo:', error);
      alert('Đã có lỗi xảy ra khi tạo báo cáo!');
    }
  }

  function clearForm() {
    document.getElementById('roomNumber').value = '';
    document.getElementById('weight').value = '';
    document.getElementById('quickWash').checked = false;
    document.getElementById('shoes').checked = false;
  }

  // Hiển thị danh sách khi tải trang
  displayEntries();
</script>
